FROM ubuntu:18.04

MAINTAINER Brian Masney <masneyb@onstation.org>

ENV TZ=America/New_York
RUN ln -snf /usr/share/zoneinfo/${TZ} /etc/localtime && echo ${TZ} > /etc/timezone

# Remove /var/lib/postgresql so that a new one will be initialized in the entrypoint.
RUN export DEBIAN_FRONTEND=noninteractive && \
    apt-get update && \
    apt-get install --no-install-recommends -y gosu postgis postgresql-10 \
                                               postgresql-10-postgis-2.4 \
                                               postgresql-10-postgis-2.4-scripts && \
    rm -rf /usr/share/doc /usr/share/man /var/lib/postgresql/* && \
    (rm /var/lib/apt/lists/* || true) && \
    apt-get clean

COPY cavedb/scripts/docker-db-entrypoint.sh /docker-db-entrypoint.sh

VOLUME ["/var/lib/postgresql"]

ENTRYPOINT ["/docker-db-entrypoint.sh"]
